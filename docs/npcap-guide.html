<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Npcap Users' Guide</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.2" /></head><body><div class="article"><div class="titlepage"><div><div><h1 class="title"><a id="idm1558856416"></a>Npcap Users' Guide</h1></div></div><hr /></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="sect1"><a href="#npcap-overview">Npcap: Nmap Project's packet sniffing library for Windows</a></span></dt><dd><dl><dt><span class="sect2"><a href="#npcap-features">Features</a></span></dt><dt><span class="sect2"><a href="#npcap-license">License</a></span></dt><dt><span class="sect2"><a href="#npcap-download">Downloads</a></span></dt><dt><span class="sect2"><a href="#npcap-architecture">Architecture</a></span></dt></dl></dd><dt><span class="sect1"><a href="#npcap-installation">Installation</a></span></dt><dd><dl><dt><span class="sect2"><a href="#npcap-installation-options">Installer options</a></span></dt><dt><span class="sect2"><a href="#npcap-installation-uninstall-options">Uninstaller options</a></span></dt><dt><span class="sect2"><a href="#npcap-installation-options-disabled">Disabled and enforced options for GUI Mode</a></span></dt><dt><span class="sect2"><a href="#npcap-installation-options-gui">How to change options for GUI Mode</a></span></dt><dt><span class="sect2"><a href="#npcap-installation-options-silent">How to change options for Silent Mode</a></span></dt></dl></dd><dt><span class="sect1"><a href="#npcap-devguide">Developing software with Npcap</a></span></dt><dd><dl><dt><span class="sect2"><a href="#npcap-get-code">Get the code</a></span></dt><dt><span class="sect2"><a href="#npcap-build">Build</a></span></dt><dt><span class="sect2"><a href="#npcap-packaging">Packaging</a></span></dt><dt><span class="sect2"><a href="#npcap-symbols">Generating debug symbols (optional)</a></span></dt><dt><span class="sect2"><a href="#npcap-development">Development</a></span></dt><dt><span class="sect2"><a href="#npcap-detect">How to detect what version Npcap/WinPcap you are using?</a></span></dt><dt><span class="sect2"><a href="#npcap-feature-native">For software that want to use Npcap first when Npcap and WinPcap coexist</a></span></dt><dt><span class="sect2"><a href="#npcap-feature-loopback">For software that uses Npcap loopback feature</a></span></dt><dt><span class="sect2"><a href="#npcap-feature-dot11">For software that uses Npcap raw 802.11 feature</a></span></dt></dl></dd><dt><span class="sect1"><a href="#npcap-qa">Q &amp; A</a></span></dt><dt><span class="sect1"><a href="#npcap-issues">Reporting Bugs</a></span></dt><dd><dl><dt><span class="sect2"><a href="#npcap-issues-diagreport">Diagnostic report</a></span></dt><dt><span class="sect2"><a href="#npcap-issues-installation-log">General installation log</a></span></dt><dt><span class="sect2"><a href="#npcap-issues-driver-installation-log">Driver installation log</a></span></dt><dt><span class="sect2"><a href="#npcap-issues-packet-log">Dynamic link library (DLL) log</a></span></dt><dt><span class="sect2"><a href="#npcap-issues-driver-log">Driver log</a></span></dt><dt><span class="sect2"><a href="#npcap-issues-bsod">Blue screen of death (BSoD) dump</a></span></dt></dl></dd><dt><span class="sect1"><a href="#npcap-list">Contact</a></span></dt></dl></div><a id="npcap-indexterm" class="indexterm"></a><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="npcap-overview"></a>Npcap: Nmap Project's packet sniffing library for Windows</h2></div></div></div><p>
  Npcap is an update of <a class="ulink" href="http://www.winpcap.org/" target="_top">WinPcap</a>
  to the <a class="ulink" href="https://msdn.microsoft.com/en-us/library/windows/hardware/ff565492(v=vs.85).aspx" target="_top">NDIS 6 Light-Weight Filter (LWF)</a> API.
  It supports <span class="command"><strong>Windows Vista, 7, 8 and 10</strong></span>. It is sponsored
  by the <a class="ulink" href="http://nmap.org/" target="_top">Nmap Project</a>
  and developed by Yang Luo
  under <a class="ulink" href="https://www.google-melange.com/gsoc/project/details/google/gsoc2013/hsluoyz/5727390428823552" target="_top">Google Summer of Code 2013</a> and
  <a class="ulink" href="https://www.google-melange.com/gsoc/project/details/google/gsoc2015/hsluoyz/5723971634855936" target="_top">2015</a>.
  It also received many helpful tests from <a class="ulink" href="https://www.wireshark.org/" target="_top">Wireshark</a>
  and <a class="ulink" href="http://www.netscantools.com/" target="_top">NetScanTools</a>.
  </p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="npcap-features"></a>Features</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="emphasis"><em>NDIS 6 Support</em></span>: Npcap makes use of new LWF driver in
  Windows Vista and later. It's faster
  than the legacy <a class="ulink" href="https://msdn.microsoft.com/en-us/library/windows/hardware/ff557012(v=vs.85).aspx" target="_top">NDIS 5 Intermediate</a>
  technique. One reason is that
  packet data stucture has changed (from <code class="varname">NDIS_PACKET</code> to <code class="varname">NET_BUFFER_LIST</code>)
  since Vista and NDIS 5 needs to handle extra packet structure conversion.</p></li><li class="listitem"><p><span class="emphasis"><em>Latest libpcap API Support</em></span>: Npcap provides support
  for the latest <a class="ulink" href="https://github.com/the-tcpdump-group/libpcap" target="_top">libpcap API</a>
  by accepting libpcap as a <a class="ulink" href="https://git-scm.com/docs/git-submodule" target="_top">Git submodule</a>.
  The latest libpcap 1.8 has integrated more fascinating features and functions than the
  <a class="ulink" href="https://www.winpcap.org/misc/changelog.htm" target="_top">deprecated libpcap 1.0.0 shipped by WinPcap</a>.
  Moreover, since Linux already has a good support for latest libpcap API, using
  Npcap on Windows facilitates your software to base on the same API on both Windows and Linux.</p></li><li class="listitem"><p><span class="emphasis"><em><span class="quote">“<span class="quote">Admin-only Mode</span>”</span> Support</em></span>: Npcap supports to restrict its
  use to Administrators for safety purpose. If Npcap is installed with
  the option <span class="quote">“<span class="quote">Restrict Npcap driver's access to Administrators only</span>”</span> checked,
  when a non-Admin user tries to start a user software (Nmap, Wireshark, etc),
  the <a class="ulink" href="http://windows.microsoft.com/en-us/windows/what-is-user-account-control#1TC=windows-7" target="_top">User Account Control (UAC)</a>
  dialog will prompt asking for Administrator privilege. Only when the end
  user chooses Yes, the driver can be accessed. This is similar to UNIX
  where you need root access to capture packets.</p></li><li class="listitem"><p><span class="emphasis"><em>Loopback Packet Capture</em></span>: Npcap is able to
  see Windows loopback packets using the
  <a class="ulink" href="https://msdn.microsoft.com/en-us/library/windows/desktop/aa366510(v=vs.85).aspx" target="_top">
  Windows Filtering Platform (WFP)</a>. After installation, Npcap will create an
  adapter named <span class="quote">“<span class="quote">Npcap
  Loopback Adapter</span>”</span> for you. If you are a Wireshark user, choose this adapter
  to capture, you will see all loopback traffic the same way as other
  non-loopback adapters. Try it by typing in commands like <span class="command"><strong>ping 127.0.0.1</strong></span>
  (IPv4) or <span class="command"><strong>ping ::1</strong></span> (IPv6).</p></li><li class="listitem"><p><span class="emphasis"><em>Loopback Packets Injection</em></span>: Besides loopback packets
  capturing, Npcap can also send out loopback packets using the
  <a class="ulink" href="https://msdn.microsoft.com/en-us/library/windows/hardware/ff556958(v=vs.85).aspx" target="_top">Winsock Kernel (WSK)</a>
  technique. A user software (e.g. Nmap) can just send packets
  out using <span class="quote">“<span class="quote">Npcap Loopback Adapter</span>”</span> like other adapters.
  <span class="quote">“<span class="quote">Npcap Loopback Adapter</span>”</span>
  will automatically remove the packet's Ethernet header and
  inject the payload into Windows TCP/IP stack.</p></li><li class="listitem"><p><span class="emphasis"><em>Raw 802.11 Packets Capture Support</em></span>: Npcap is able to see
  <span class="emphasis"><em>802.11</em></span> packets instead of <span class="emphasis"><em>fake Ethernet</em></span> packets on ordinary wireless
  adapters. You need to select the <code class="option">Support raw 802.11 traffic (and monitor
  mode) for wireless adapters</code> option in the installation wizard to enable
  this feature. When your adapter is in <span class="quote">“<span class="quote">Monitor Mode</span>”</span>, Npcap will supply all
  <span class="emphasis"><em>802.11 data + control + management</em></span> packets with radiotap headers. When
  your adapter is in <span class="quote">“<span class="quote">Managed Mode</span>”</span>, Npcap will only supply <span class="emphasis"><em>Ethernet</em></span>
  packets. Npcap directly supports to use Wireshark to capture in <span class="quote">“<span class="quote">Monitor Mode</span>”</span>.
  Meantime, Npcap also provides the <code class="filename">WlanHelper.exe</code>
  tool to help you switch to <span class="quote">“<span class="quote">Monitor Mode</span>”</span> on your own. See more details
  about this feature in section
  <span class="quote">“<span class="quote"><a class="link" href="#npcap-feature-dot11" title="For software that uses Npcap raw 802.11 feature">For software that uses Npcap raw 802.11 feature</a></span>”</span>.
  See more details about radiotap here:
  <a class="ulink" href="http://www.radiotap.org/" target="_top">http://www.radiotap.org/</a></p></li><li class="listitem"><p><span class="emphasis"><em><span class="quote">“<span class="quote">WinPcap Compatible Mode</span>”</span>
  Support</em></span>: <span class="quote">“<span class="quote">WinPcap Compatible Mode</span>”</span> makes Npcap a
  strict WinPcap replacement by using the same DLL location and service name as
  WinPcap. This is useful for testing or migrating from software that only uses
  WinPcap, but because Npcap is masquerading as WinPcap, software will not be
  able to be aware of and use Npcap's newer features.  It's notable that before
  installing in
  this mode, you must uninstall WinPcap first (the installer wizard will
  prompt you that).</p></li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="npcap-license"></a>License</h3></div></div></div><p>
    See: <a class="ulink" href="http://npcap.org/#License" target="_top">Npcap License</a>
  </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="npcap-download"></a>Downloads</h3></div></div></div><p>
    <a class="ulink" href="http://npcap.org/#download" target="_top">Latest Npcap release</a>.
  </p><p>
  <a class="ulink" href="http://nmap.org/npcap/dist/" target="_top">Archived Npcap releases</a>.
  </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="npcap-architecture"></a>Architecture</h3></div></div></div><p>
  Npcap tries to keep the original WinPcap architecture as much as possible.
  As the table shows, you will find it very similar with WinPcap.
  </p><div class="table"><a id="idm1558819040"></a><p class="title"><strong>Table 1. Npcap Architecture</strong></p><div class="table-contents"><table class="table" summary="Npcap Architecture" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th align="left">Binary</th><th align="left">Source</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left">wpcap.dll</td><td align="left">wpcap</td><td align="left">the libpcap API, added "loopback support" to original WinPcap</td></tr><tr><td align="left">Packet.dll</td><td align="left">packetWin7\Dll</td><td align="left">the Packet API for Windows, added "Admin-only Mode" to original WinPcap</td></tr><tr><td align="left">npcap.sys</td><td align="left">packetWin7\npf</td><td align="left">the filter driver. If Npcap is installed in <span class="quote">“<span class="quote">WinPcap Compatible Mode</span>”</span>, the driver name is <em class="replaceable"><code>npf</code></em>.sys</td></tr><tr><td align="left">NPFInstall.exe</td><td align="left">packetWin7\NPFInstall</td><td align="left">a LWF and WFP driver installation tool</td></tr><tr><td align="left">NpcapHelper.exe</td><td align="left">packetWin7\Helper</td><td align="left">the helper program for <span class="quote">“<span class="quote">Admin-only Mode</span>”</span>, will run under <span class="emphasis"><em>Administrator</em></span> rights</td></tr><tr><td align="left">WlanHelper.exe</td><td align="left">packetWin7\WlanHelper</td><td align="left">a tool is used to set/get the operation mode (like <span class="quote">“<span class="quote">Monitor Mode</span>”</span>) for a wireless adapter, will run under <span class="emphasis"><em>Administrator</em></span> rights</td></tr></tbody></table></div></div><br class="table-break" /></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="npcap-installation"></a>Installation</h2></div></div></div><p>
  Please refer to <a class="ulink" href="http://www.npcap.org/#License" target="_top">the Npcap License</a> for terms of use and redistribution.
  </p><p>
  The Npcap installer and uninstaller are easy to use in
  <span class="quote">“<span class="quote">Graphical Mode</span>”</span> (direct run) and <span class="quote">“<span class="quote">Silent Mode</span>”</span> (run with
  <code class="option">/S</code> parameter).
  </p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="npcap-installation-options"></a>Installer options</h3></div></div></div><p>
      The installer accepts several command-line options that correspond to the
      options presented in the graphical interface (GUI).  The options take the form
      <code class="option">/<em class="replaceable"><code>name</code></em>=<em class="replaceable"><code>value</code></em></code>,
      where <em class="replaceable"><code>name</code></em> is one of
      <code class="option">/npf_startup</code>, <code class="option">/loopback_support</code>,
      <code class="option">/dlt_null</code>, <code class="option">/admin_only</code>,
      <code class="option">/dot11_support</code>, <code class="option">/vlan_support</code>,
      or <code class="option">/winpcap_mode</code>.
    </p><p>The values for these options must be one of:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="option">yes</code>: select the option</p></li><li class="listitem"><p><code class="option">no</code>: unselect the option</p></li><li class="listitem"><p><code class="option">enforced</code>: select the option and make it unchangable in the GUI</p></li><li class="listitem"><p><code class="option">disabled</code>: unselect the option and make it unchangable in the GUI</p></li></ul></div><p>There is also one option that does not appear in the GUI, which is
      <code class="option">/disable_restore_point=yes</code>, which will prevent the
      installer from setting a system restore point. Windows may independently
      create a restore point because of the driver installation independent
      from this option.
    </p><p>The destination directory for installation can also be overridden by
    the <code class="option">/D</code> option, with a few restrictions. First, it will
    only affect where Npcap keeps its installation logs and helper utilities.
    The driver and DLLs will always be installed into the appropriate
    directories below <span class="command"><strong>%SYSTEMROOT%\System32\</strong></span>. Second, the
    <code class="option">/D</code> must be the last option in the command, and the path
    must not contain quotes. For example, to change the installation directory
    to <code class="filename">C:\Path With Spaces\</code>, the invocation would be:
    <span class="command"><strong>npcap-<em class="replaceable"><code>version</code></em>.exe /D=C:\Path With Spaces</strong></span>
    </p><p>
    An example of Npcap installer options is (for both <span class="quote">“<span class="quote">GUI Mode</span>”</span> and <span class="quote">“<span class="quote">Silent Mode</span>”</span>):
    </p><p>
    <code class="option">/npf_startup=yes /loopback_support=yes /dlt_null=no /admin_only=yes /dot11_support=yes /vlan_support=yes /winpcap_mode=yes</code>
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="option">/npf_startup=yes</code>: Automatically start the Npcap driver at boot time</p></li><li class="listitem"><p><code class="option">/loopback_support=yes</code>: Support loopback traffic (<span class="quote">“<span class="quote">Npcap Loopback Adapter</span>”</span> will be created)</p></li><li class="listitem"><p><code class="option">/dlt_null=no</code>: Use <code class="varname">DLT_EN10MB</code> (Ethernet) as the
        <span class="quote">“<span class="quote">Npcap Loopback Adapter</span>”</span>'s link layer protocol instead of the default <code class="varname">DLT_NULL</code>.
	</p></li><li class="listitem"><p><code class="option">/admin_only=yes</code>: Restrict Npcap driver's access to Administrators only</p></li><li class="listitem"><p><code class="option">/dot11_support=yes</code>: Support raw 802.11 traffic (and <span class="quote">“<span class="quote">Monitor Mode</span>”</span>) for wireless adapters</p></li><li class="listitem"><p><code class="option">/vlan_support=yes</code>: Support 802.1Q VLAN tag when capturing and sending data</p></li><li class="listitem"><p><code class="option">/winpcap_mode=yes</code>: Install Npcap in WinPcap API-compatible Mode</p></li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="npcap-installation-uninstall-options"></a>Uninstaller options</h3></div></div></div><p>
    The uninstaller provided with Npcap also accepts some command-line options.
  The <code class="option">/Q</code> flag means to skip the confirmation page and finish page in the uninstall wizard. So this option is
	only meaningful for <span class="quote">“<span class="quote">GUI Mode</span>”</span>. The <code class="option">/no_kill</code> controls how the uninstaller handles
	processes that are still using Npcap at the time of uninstall. If <code class="option">/no_kill=yes</code>
	 is specified, then Npcap uninstaller will fail if there are still applications using Npcap driver or DLLs.
   If <code class="option">/no_kill=no</code> is specified in silent mode, Npcap uninstaller will immediately terminate any command-line processes that are using
	Npcap (like a Nmap process that is still scanning), and wait for at most 15 seconds to gracefully terminate any GUI processes
	that are using Npcap (like Wireshark UI that is still capturing). <span class="quote">“<span class="quote">gracefully</span>”</span> means that if you are
	still capturing via Wireshark, Wireshark UI will prompt the user about whether to save the current capture to a pcap.
	So the user have 15 seconds to save his session. Note: although Npcap uninstaller won't terminate Wireshark UI processe
	immediately, the live capture stops immediately. This is because Wireshark UI uses command-line processes named
	<code class="varname">dumpcap.exe</code> to capture, and that command-line process will be terminated immediately. The default
  value for <code class="option">/no_kill</code> is <code class="option">no</code>, but if the
  graphical interface is used (without <code class="option">/S</code>), the user will be
  prompted for what to do.
    </p><p>
    An example of Npcap uninstaller options is:
    </p><p>
    <code class="option">/S /Q /no_kill=yes</code>
    </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="npcap-installation-options-disabled"></a>Disabled and enforced options for GUI Mode</h3></div></div></div><p>
	We may disable or enforce certain options in the installer GUI to make them unselectable. This
	usually means that those options can easily cause compatibility issues and are considered
	not suitable for most users, or we think we need to enforce some rules for the Npcap API. Advanced users can still change their states via command-line
	parameters, which is described in following sections.
    </p><p>
	Fortunately, if a distributor wants to start the Npcap installer GUI and disable or enforce
	certain options for reasons like compatibility. It can also use the four value
	mechanism by setting the command-line parameters to <code class="option">disabled</code> or <code class="option">enforced</code>.
	For example, the following command will start an installer GUI with the
	<code class="option">dlt_null</code> disabled and unselected:
    </p><p>
    <span class="command"><strong>npcap-<em class="replaceable"><code>version</code></em>.exe /dlt_null=disabled</strong></span>
    </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="npcap-installation-options-gui"></a>How to change options for GUI Mode</h3></div></div></div><p>
    Default options for Npcap installer GUI can be changed. An example is:
    </p><p>
    <span class="command"><strong>npcap-<em class="replaceable"><code>version</code></em>.exe /npf_startup=yes /loopback_support=yes /dlt_null=yes /admin_only=no /dot11_support=no /vlan_support=no /winpcap_mode=yes</strong></span>
    </p><p>
    Because most of these are the default values for these options, this example could be even simpler:
    </p><p>
    <span class="command"><strong>npcap-<em class="replaceable"><code>version</code></em>.exe /winpcap_mode=yes</strong></span>
    </p><p>
     Running the installer
	directly without options will see <code class="option">Install Npcap in WinPcap API-compatible Mode</code>
	<span class="emphasis"><em>UNCHECKED</em></span> by default in the <span class="quote">“<span class="quote">Installation Options</span>”</span> page.
	However, the above two commands will launch the installer GUI, and in the <span class="quote">“<span class="quote">Installation Options</span>”</span> page, the
	<code class="option">Install Npcap in WinPcap API-compatible Mode</code> option will be <span class="emphasis"><em>CHECKED</em></span> by default.
    </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="npcap-installation-options-silent"></a>How to change options for Silent Mode</h3></div></div></div><p>
    An example of changing option features for silent installation is:
    </p><p>
    <span class="command"><strong>npcap-<em class="replaceable"><code>version</code></em>.exe /S /admin_only=yes /dot11_support=yes /vlan_support=yes</strong></span>
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>If you doesn't specify a parameter key, it will take the default value.
    This is the same with the GUI.</p></li><li class="listitem"><p>The keys are <span class="emphasis"><em>case-insensitive</em></span>.</p></li><li class="listitem"><p>The values are <span class="emphasis"><em>case-sensitive</em></span>, only two values are
    permitted: <code class="option">yes</code> or <code class="option">no</code>.</p></li></ul></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="npcap-devguide"></a>Developing software with Npcap</h2></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="npcap-get-code"></a>Get the code</h3></div></div></div><p>
  Run <span class="command"><strong>git clone https://github.com/nmap/npcap</strong></span>: pull this repo. This repo contains
  <a class="ulink" href="https://github.com/the-tcpdump-group/libpcap" target="_top">libpcap</a> as a
  submodule, so make sure that you have also pulled all the submodules.
  </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="npcap-build"></a>Build</h3></div></div></div><p>
  Run <span class="command"><strong>installer\Build.bat</strong></span>: build all DLLs and the driver. The DLLs need to be built
  using Visual Studio 2013. And the driver needs to be built using Visual Studio 2015 with Windows SDK
  10 10586 &amp; Windows Driver Kit 10 10586.
  
  
  The build of <code class="filename">wpcap.dll</code> also requires
  to install <a class="ulink" href="https://sourceforge.net/projects/winflexbison/" target="_top">Win flex-bison</a>.
  Please unzip the downloaded package and add the directory to the <code class="filename">PATH</code>
  environment variable.
  </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="npcap-packaging"></a>Packaging</h3></div></div></div><p>
    The Npcap installer is built and signed privately and distributed only from Npcap.org.
  </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="npcap-symbols"></a>Generating debug symbols (optional)</h3></div></div></div><p>
    Debug symbols for Npcap releases are distributed from Npcap.org. Visual
    Studio will generate <code class="filename">.pdb</code> symbol files as part of the
    build process.
  </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="npcap-development"></a>Development</h3></div></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="npcap-sdk"></a>SDK</h4></div></div></div><p>
      To build software that uses Npcap, use the latest version of the Npcap Software Development Kit (SDK).
    The latest SDK can be downloaded on <a class="ulink" href="http://npcap.org/#download" target="_top">Npcap.org</a>.
    Updates to the SDK are much less frequent than updates to the Npcap binaries.
    </p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="npcap-documentation"></a>Documentation</h4></div></div></div><p>
      This document addresses Npcap's latest features and installation. For details on how to write software using Npcap, refer to the
      <a class="ulink" href="https://cdn.rawgit.com/nmap/npcap/v0.92/dox/intro.htm" target="_top">API documentation</a>.
    </p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="npcap-examples"></a>Examples</h4></div></div></div><p>
    Examples of applications using Npcap are available <a class="ulink" href="https://github.com/nmap/npcap/tree/master/Examples" target="_top">in the Examples directory</a> in the source distribution.
    </p><p>
    Npcap developer Yang Luo has also provided an example:
	<a class="ulink" href="https://github.com/hsluoyz/UserBridge/" target="_top">UserBridge</a>,
	which is a tool to redirect all packets from one interface to another.
    </p></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="npcap-detect"></a>How to detect what version Npcap/WinPcap you are using?</h3></div></div></div><p>
  Sometimes, our user software needs to detect the existence of Npcap/WinPcap
  at install-time or run-time. Although Npcap's GUI installer has the ability
  to handle this, you may want to handle it by yourself in some conditions,
  like you run Npcap installer in silent-mode.  The run-time detection is even
  more useful. Your software probably has some functions that rely on Npcap's
  particular features (like the loopback interface). You need to know if you
  are running on top of Npcap or the legacy WinPcap to control whether to
  switch your functions on.  Fortunately, Npcap provides you some methods to
  detect Npcap/WinPcap at install-time and run-time.
  </p><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="npcap-detect-version"></a>Npcap version</h4></div></div></div><p> Npcap has a version number that is independent of WinPcap. The last
      release of WinPcap was version 4.1.3, but Npcap started over counting
      versions from 0.00. In order to make it clear to the installers and other
      software that Npcap is newer and more advanced, the executable
      <span class="quote">“<span class="quote">file version</span>”</span> was advanced to <span class="quote">“<span class="quote">5.0.0.000</span>”</span> at
      that point. The major version will always be <span class="quote">“<span class="quote">5</span>”</span> to
      distinguish Npcap from WinPcap. The minor version is Npcap's major
      version; the revision is Npcap's minor version; and the build number is
      an encoding of the build date. So a file version of
      <span class="quote">“<span class="quote">5.0.92.612</span>”</span> is Npcap 0.92, built on June 12th.</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="npcap-detect-install-time"></a>Install-time detection</h4></div></div></div><p>
      You can check the existence of <code class="filename">C:\Program Files\Npcap\NPFInstall.exe</code> to
      detect Npcap's existence. If Npcap exists, you can check the file version of
      <code class="filename">C:\Program Files\Npcap\NPFInstall.exe</code> to detect Npcap e-version. The
      e-version also gives you the version. The NSIS code is shown below. <code class="varname">$inst_ver</code>
      is an e-version string like <span class="quote">“<span class="quote">5.0.7.424</span>”</span>
    </p><pre class="screen">
GetDllVersion "C:\Program Files\Npcap\NPFInstall.exe" $R0 $R1
IntOp $R2 $R0 / 0x00010000
IntOp $R3 $R0 &amp; 0x0000FFFF
IntOp $R4 $R1 / 0x00010000
IntOp $R5 $R1 &amp; 0x0000FFFF
StrCpy $inst_ver "$R2.$R3.$R4.$R5"
</pre><p>
      You can check the installation options of an already installed Npcap by reading the registry
      key: <code class="filename">HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\npcap\Parameters</code>.
      The entries like <code class="filename">AdminOnly</code>,
      <code class="filename">Loopback</code>, <code class="filename">DltNull</code>,<code class="filename">Dot11Support</code>,
      <code class="filename">VlanSupport</code>, <code class="filename">WinPcapCompatible</code>, etc. show the installation options.
      <code class="filename">Loopback</code> is <code class="code">REG_SZ</code> type. A non-NULL value indicates the option is
      <span class="emphasis"><em>CHECKED</em></span>. All other entries are <code class="code">REG_DWORD</code> type. A 0x00000001 value
      indicates the option is <span class="emphasis"><em>CHECKED</em></span>.
    </p><p>Note: Prior to Npcap 0.93, these values were stored in the
	    <code class="filename">Services\npcap</code> key directly.</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="npcap-detect-run-time"></a>Run-time detection</h4></div></div></div><p>
      Npcap and WinPcap can be installed together on a system. Which capture
      library is used by the user software relies on the DLL loading path. If
      Npcap's <code class="filename">wpcap.dll</code> is loaded first, then you are using
      Npcap, vice versa. However, it's difficult and fragile to check the DLL
      loading path by yourself.  Fortunately, you can use
      <code class="function">pcap_lib_version</code> to get the Npcap/WinPcap version
      string.
  </p><pre class="screen">
char *pcap_version = pcap_lib_version();
printf("%s", pcap_version);
// Npcap output: "Npcap version 0.92, based on libpcap version 1.8.1"
// WinPcap output: "WinPcap version 4.1.3"
</pre><p>Npcap requires the <code class="varname">npcap</code> service to be running. If
  installed in <span class="quote">“<span class="quote">WinPcap Compatible Mode</span>”</span>, the
  <code class="varname">npf</code> service can be started instead.  Given that
  <code class="varname">npcap</code> service is always installed
  in both modes, a good practice is just trying the <code class="varname">npcap</code> service first.
  If it fails, then try the <code class="varname">npf</code> service. This is also what most of our users
  do in their software based on our investigation. A code sample from Nmap is
  <a class="ulink" href="https://github.com/nmap/nmap/blob/8c8e4a08c6c6b7abd2343e5921aafb6077bdb257/mswin32/winfix.cc#L322-L328" target="_top">here</a>.
    </p></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="npcap-feature-native"></a>For software that want to use Npcap first when Npcap and WinPcap coexist</h3></div></div></div><p>
  Prerequisite: Uncheck the <code class="option">Install Npcap in WinPcap API-compatible Mode</code> option at
  install-time (which is by default).
  </p><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="npcap-feature-native-dll"></a>DLL loading</h4></div></div></div><p>Npcap installs its DLLs into <code class="filename">C:\Windows\System32\Npcap\</code>
    instead of WinPcap's <code class="filename">C:\Windows\System32\</code>. Because of how Windows'
    <a class="ulink" href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms686203(v=vs.85).aspx" target="_top">DLL search path</a> works,
    your application will use WinPcap first by default when Npcap and WinPcap coexist,
    as <code class="filename">C:\Windows\System32\</code> is prior to <code class="filename">C:\Windows\System32\Npcap\</code>.
    So when Npcap and WinPcap coexist, an application that want to use Npcap instead
    of WinPcap must make <code class="filename">C:\Windows\System32\Npcap\</code> precedent to the
    <code class="filename">C:\Windows\System32\</code> in the DLL search path. Here are two ways
    to modify this search path to make your application load Npcap's DLLs first,
    based on how your application links Npcap/WinPcap's library
    (<code class="filename">wpcap.dll</code>).</p><div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a id="npcap-feature-native-dll-implicitly"></a>If the application <span class="emphasis"><em>implicitly</em></span> links <code class="filename">wpcap.dll</code></h5></div></div></div><p>Implicit linking means that either you specified <code class="filename">wpcap.lib</code>
      in your <code class="option">Project Properties</code> -&gt; <code class="option">Configuration Properties</code>
      -&gt; <code class="option">Linker</code> -&gt; <code class="option">Input</code> -&gt; <code class="option">Additional Dependencies</code> in Visual Studio,
      or specified <code class="code">#pragma comment(linker, "wpcap.lib")</code> in your code.</p><p>You need to do the following two steps:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Specify <code class="filename">wpcap.dll</code> as a delay-loaded DLL: In
      Visual Studio, open the <code class="option">Project Properties</code> window. Go to:
      <code class="option">Configuration Properties</code> -&gt; <code class="option">Linker</code> -&gt; <code class="option">Input</code>
      -&gt; <code class="option">Delay Loaded Dlls</code>. Enter <code class="filename">wpcap.dll</code>
      in that option.</p></li><li class="listitem"><p>Before calling any <code class="filename">wpcap.dll</code> functions,
      call <code class="function">SetDllDirectory</code> to add <code class="filename">C:\Windows\System32\Npcap\</code>
      to DLL search path.</p></li></ul></div><p><a class="ulink" href="https://github.com/hsluoyz/WinDump/" target="_top">Here</a>
      is an example called WinDump, a simple packet capture tool using Npcap/WinPcap.
      And <a class="ulink" href="https://github.com/hsluoyz/WinDump/commit/dffe2eaa520fc3b449ec0a90dcfa24f96359bbfa" target="_top">this commit</a>
      makes it able to use Npcap first when Npcap and WinPcap coexist.</p></div><div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a id="npcap-feature-native-dll-explicitly"></a>If the application <span class="emphasis"><em>explicitly</em></span> links <code class="filename">wpcap.dll</code></h5></div></div></div><p>Explicit linking means that you explicitly called <code class="function">LoadLibrary</code>
      to load <code class="filename">wpcap.dll</code> and called <code class="function">GetProcAddress</code> to get the
      function pointers.</p><p>You need to do the following one step:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Before calling <code class="function">LoadLibrary</code> to load <code class="filename">wpcap.dll</code>,
      call <code class="function">SetDllDirectory</code> to add <code class="filename">C:\Windows\System32\Npcap\</code>
      to DLL search path.</p></li></ul></div><p>The function <code class="function">init_npcap_dll_path</code> is provided in the following example:
      <a class="ulink" href="https://github.com/hsluoyz/WinDump/commit/dffe2eaa520fc3b449ec0a90dcfa24f96359bbfa" target="_top">WinDump</a></p></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="npcap-feature-native-servicename"></a>Service name</h4></div></div></div><p>Npcap uses service name <span class="quote">“<span class="quote">npcap</span>”</span> instead of WinPcap's <span class="quote">“<span class="quote">npf</span>”</span> with
    <span class="quote">“<span class="quote">WinPcap Compatible Mode</span>”</span> OFF. So applications using
    <span class="command"><strong>net start npf</strong></span> for starting service must change to this:
    run <span class="command"><strong>net start npcap</strong></span> first, if it fails, then try
    <span class="command"><strong>net start npf</strong></span>.</p></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="npcap-feature-loopback"></a>For software that uses Npcap loopback feature</h3></div></div></div><p>
  Prerequisite: Check the <code class="option">Support loopback traffic ("Npcap Loopback Adapter" will be created)</code> option at install-time.
  </p><p>
  Npcap's loopback adapter device is based on <span class="quote">“<span class="quote">Microsoft KM-TEST Loopback Adapter</span>”</span>
  (Win8 and Win10) or <span class="quote">“<span class="quote">Microsoft Loopback Adapter</span>”</span> (Vista, Win7). It is an Ethernet
  adapter, and Npcap has changed its behavior and renamed it to <span class="quote">“<span class="quote">Npcap Loopback Adapter</span>”</span>,
  to make it see the real loopback traffic only.
  </p><p>
  The IP address of <span class="quote">“<span class="quote">Npcap Loopback Adapter</span>”</span> is usually like 169.254.x.x. However,
  this IP is totally meaningless. Software using Npcap should regard this interface's IP address
  as 127.0.0.1 (IPv4) and ::1 (IPv6). This work can't be done by Npcap because Windows forbids
  any IP address to be configured as 127.0.0.1 or ::1 as they're reserved.
  </p><p>
  The MAC address of <span class="quote">“<span class="quote">Npcap Loopback Adapter</span>”</span> is usually like 02:00:4C:4F:4F:50. However,
  this address is meaningless too. Software using Npcap should think this interface doesn't own a
  MAC address, as the loopback traffic never goes to link layer. For software using Npcap to
  capture loopback traffic, the MAC addresses in captured data will be all zeros (aka 00:00:00:00:00:00).
  For software using Npcap to send loopback traffic, any MAC addresses can be specified as they
  will be ignored. But notice that ether_type in Ethernet header should be set correctly. Only <code class="option">IPv4</code>
  and <code class="option">IPv6</code> are accepted. Other values like <code class="option">ARP</code> will be ignored. (You don't need an ARP request for
  loopback interface)
  
  </p><p>
  The MTU of <span class="quote">“<span class="quote">Npcap Loopback Adapter</span>”</span> is hard-coded to 65536 by Npcap. Software
  using Npcap should get this value automatically and no special handling is needed. This value is
  arbitrary and does not imply a limitation on the Windows loopback stack,
  so it may be possible to capture packets with a size larger than the adapter's MTU.
  </p><p>
  Don't try to make OID requests to <span class="quote">“<span class="quote">Npcap Loopback Adapter</span>”</span> except
  <code class="varname">OID_GEN_MAXIMUM_TOTAL_SIZE</code> (MTU). Those requests will still succeed like
  other adapters do, but they only make sense for NDIS adapters and Npcap doesn't even use the
  NDIS way to handle the loopback traffic. The only handled OID request by Npcap is
  <code class="varname">OID_GEN_MAXIMUM_TOTAL_SIZE</code>. If you query its value, you will always get
  65550 (65536 + 14). If you try to set its value, the operation will always fail.
  </p><p>
  To conclude, a software that wants to support Npcap loopback feature should do these steps:
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Detect Npcap Loopback Adapter's presence, by reading registry value Loopback
  at key <code class="filename">HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\npcap\Parameters</code>.
  If <code class="filename">LoopbackSupport</code> is 0x00000001, then the adapter's device name is in the <code class="filename">LoopbackAdapter</code> REG_SZ value.
  Then perform the following steps.</p></li><li class="listitem"><p>Treat the IP address of <span class="quote">“<span class="quote">Npcap Loopback Adapter</span>”</span> as 127.0.0.1 (IPv4) and ::1 (IPv6).</p></li><li class="listitem"><p>Treat the MAC address of <span class="quote">“<span class="quote">Npcap Loopback Adapter</span>”</span> as 00:00:00:00:00:00.</p></li><li class="listitem"><p>If you use IP Helper API to get adapter list, you will get an interface named
  like <span class="quote">“<span class="quote">Loopback Pseudo-Interface 1</span>”</span>. This interface is a DUMMY interface by Microsoft
  and can't be seen in NDIS layer. And it also takes the 127.0.0.1/::1 IP address. A good practice
  for software is merging the entry of <span class="quote">“<span class="quote">Npcap Loopback Adapter</span>”</span> and the entry of
  <span class="quote">“<span class="quote">Loopback Pseudo-Interface 1</span>”</span> into one entry, like what I have implemented for Nmap (see the
  <span class="quote">“<span class="quote">Other code (for developers)</span>”</span> part).</p></li><li class="listitem"><p>Don't make use of OID requests for <span class="quote">“<span class="quote">Npcap Loopback Adapter</span>”</span>
  except <code class="varname">OID_GEN_MAXIMUM_TOTAL_SIZE</code> requests.</p></li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="npcap-feature-dot11"></a>For software that uses Npcap raw 802.11 feature</h3></div></div></div><p>
  Prerequisite: Check the <code class="option">Support raw 802.11 traffic (and monitor mode) for wireless adapters</code> option at install-time.
  </p><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="npcap-feature-dot11-steps"></a>Steps</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Install the latest version Npcap with the
      <code class="option">Support raw 802.11 traffic (and monitor mode) for wireless
      adapters</code> option checked in the installation wizard. With this
      option checked, Npcap will see packets with <span class="emphasis"><em>Radiotap +
      802.11</em></span> headers for wireless adapters. Otherwise, Npcap will
      see packets with <span class="emphasis"><em>fake Ethernet</em></span> headers for wireless
      adapters.</p></li><li class="listitem"><p>Run <code class="filename">WlanHelper.exe</code> with
      <span class="emphasis"><em>Administrator privilege</em></span>. If you use
      <code class="option">-i</code>, follow the interactive prompts to choose your
      wireless adapter and select <span class="quote">“<span class="quote">Network Monitor</span>”</span> mode.
      <code class="filename">WlanHelper.exe</code> also supports parameters to be used
      in an API manner, run <span class="command"><strong>WlanHelper.exe -h</strong></span> for
      details.</p></li><li class="listitem"><p>Use the Npcap API from your user software as usual. For
      example, launch Wireshark and capture on the wireless adapter, viewingall
      802.11 packets (<span class="emphasis"><em>data + control + management</em></span>).
  </p></li><li class="listitem"><p>If you need to return to <span class="quote">“<span class="quote">Managed Mode</span>”</span>, run
      <span class="command"><strong>WlanHelper.exe</strong></span> again, following the prompts or
      selecting the appropriate command-line options to switch off the
      <span class="quote">“<span class="quote">Monitor Mode</span>”</span>.</p></li></ul></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="npcap-feature-dot11-tips"></a>Tips</h4></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>You need to use <code class="filename">WlanHelper.exe</code> tool to
        switch on the <span class="quote">“<span class="quote">Monitor Mode</span>”</span> in order to see
        <span class="emphasis"><em>802.11 control and management</em></span> packets in Wireshark
        (also <span class="emphasis"><em>encrypted 802.11 data</em></span> packets, you need to
        specify the decipher key in Wireshark in order to decrypt those
        packets), otherwise you will only see 802.11 data
        packets.</p></li><li class="listitem"><p>Switching on the <span class="quote">“<span class="quote">Monitor Mode</span>”</span> will
        disconnect your wireless network from the AP, you can switch back to
        <span class="quote">“<span class="quote">Managed Mode</span>”</span> using the same
        <code class="filename">WlanHelper.exe</code> tool.</p></li><li class="listitem"><p>The <code class="filename">WlanHelper.exe</code> tool is
        installed to <span class="quote">“<span class="quote">%SYSTEMROOT%\System32\Npcap</span>”</span> after installing Npcap.</p></li></ul></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="npcap-feature-dot11-terminology"></a>Terminology</h4></div></div></div><p>
      <span class="quote">“<span class="quote">Managed Mode</span>”</span> (for Linux) = <span class="quote">“<span class="quote">Extensible Station Mode</span>”</span> (aka <span class="quote">“<span class="quote">ExtSTA</span>”</span>, for Windows)
    </p><p>
      <span class="quote">“<span class="quote">Monitor Mode</span>”</span> (for Linux) = <span class="quote">“<span class="quote">Network Monitor Mode</span>”</span> (aka <span class="quote">“<span class="quote">NetMon</span>”</span>, for Windows)
    </p><p>
      <span class="quote">“<span class="quote">Master Mode</span>”</span> (for Linux) = <span class="quote">“<span class="quote">Extensible Access Point</span>”</span> (aka <span class="quote">“<span class="quote">ExtAP</span>”</span>, for Windows)
    </p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="npcap-feature-dot11-wlanhelper"></a>WlanHelper</h4></div></div></div><p>
      WlanHelper is used to set/get the operation mode (like <span class="quote">“<span class="quote">Monitor
      Mode</span>”</span>) for a wireless adapter on Windows.  WlanHelper tries to
      follow the grammar of <code class="filename">iwconfig</code>, a wireless
      management tool for Linux. So if you rename
      <code class="filename">WlanHelper.exe</code> to <code class="filename">iwconfig.exe</code>,
      your command lines for WlanHelper will be exactly the same with the
      iwconfig tool.
    
    </p><div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a id="npcap-feature-dot11-wlanhelper-usage"></a>WlanHelper's Usage</h5></div></div></div><p>
        Note: <span class="command"><strong>WlanHelper</strong></span> must run under <span class="emphasis"><em>Administrator privilege</em></span>.
      </p><div class="sect5"><div class="titlepage"><div><div><h6 class="title"><a id="npcap-feature-dot11-wlanhelper-usage-interactive"></a>Interactive way</h6></div></div></div><p>
          Run <span class="command"><strong>WlanHelper</strong></span> with the <code class="option">-i</code> option.
        </p></div><div class="sect5"><div class="titlepage"><div><div><h6 class="title"><a id="npcap-feature-dot11-wlanhelper-usage-api"></a>Command-line API way</h6></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Run <span class="command"><strong>netsh wlan show interfaces</strong></span>, get the <code class="option">Name</code> or <code class="option">GUID</code> for the interface.</p></li><li class="listitem"><p>Run <span class="command"><strong>WlanHelper -h</strong></span> to see the man page.</p></li></ul></div><div class="example"><a id="npcap-ex-wlanhelper-man"></a><p class="title"><strong>Example 1. WlanHelper Man</strong></p><div class="example-contents"><pre class="screen">
C:\&gt; <strong class="userinput"><code>WlanHelper.exe</code></strong>
WlanHelper for Npcap 0.91 ( http://npcap.org )
Usage: WlanHelper [Commands]
   or: WlanHelper {Interface Name or GUID} [Options]

OPTIONS:
  mode                  : Get interface operation mode
  mode &lt;managed|monitor|master|..&gt;  : Set interface operation mode
  modes                 : Get all operation modes supported by the interface, comma-separated
  channel               : Get interface channel
  channel &lt;1-14&gt;            : Set interface channel (only works in monitor mode)
  freq                  : Get interface frequency
  freq &lt;VALUE&gt;              : Set interface frequency (only works in monitor mode)
  modu                  : Get interface modulation
  modu &lt;dsss|fhss|irbaseband|ofdm|hrdsss|erp|ht|vht|ihv (VALUE)|..&gt; : Set interface modulation
  modus                 : Get all modulations supported by the interface, comma-separated

COMMANDS:
  -i                    : Enter the interactive mode
  -h                    : Print this help summary page

OPERATION MODES:
  managed   : The Extensible Station (ExtSTA) operation mode
  monitor   : The Network Monitor (NetMon) operation mode
  master    : The Extensible Access Point (ExtAP) operation mode (supported from Windows 7 and later)
  wfd_device    : The Wi-Fi Direct Device operation mode (supported from Windows 8 and later)
  wfd_owner : The Wi-Fi Direct Group Owner operation mode (supported from Windows 8 and later)
  wfd_client    : The Wi-Fi Direct Client operation mode (supported from Windows 8 and later)

802.11 MODULATIONS (https://en.wikipedia.org/wiki/IEEE_802.11):
  802.11-1997   : dsss, fhss
  802.11a   : ofdm
  802.11b   : dsss
  802.11g   : ofdm
  802.11n   : mimo-ofdm
  802.11ac  : mimo-ofdm

EXAMPLES:
  WlanHelper Wi-Fi mode
  WlanHelper 42dfd47a-2764-43ac-b58e-3df569c447da channel 11
  WlanHelper 42dfd47a-2764-43ac-b58e-3df569c447da freq 2
  WlanHelper "Wireless Network Connection" mode monitor

SEE THE MAN PAGE (https://github.com/nmap/npcap) FOR MORE OPTIONS AND EXAMPLES
        </pre></div></div><br class="example-break" /><p>
          An example:
        </p><div class="example"><a id="npcap-ex-wlanhelper-api"></a><p class="title"><strong>Example 2. WlanHelper API Usage</strong></p><div class="example-contents"><pre class="screen">
C:\&gt; <strong class="userinput"><code>netsh wlan show interfaces</code></strong>

There is 1 interface on the system:

    Name                   : <em class="replaceable"><code>Wi-Fi</code></em>
    Description            : Qualcomm Atheros AR9485WB-EG Wireless Network Adapter
    GUID                   : <em class="replaceable"><code>42dfd47a-2764-43ac-b58e-3df569c447da</code></em>
    Physical address       : a4:db:30:d9:3a:9a
    State                  : connected
    SSID                   : LUO-PC_Network
    BSSID                  : d8:15:0d:72:8c:18
    Network type           : Infrastructure
    Radio type             : 802.11n
    Authentication         : WPA2-Personal
    Cipher                 : CCMP
    Connection mode        : Auto Connect
    Channel                : 1
    Receive rate (Mbps)    : 150
    Transmit rate (Mbps)   : 150
    Signal                 : 100%
    Profile                : LUO-PC_Network

    Hosted network status  : Not available

C:\&gt; <strong class="userinput"><code>WlanHelper.exe <em class="replaceable"><code>wi-fi</code></em> mode</code></strong>
managed
C:\&gt; <strong class="userinput"><code>WlanHelper.exe <em class="replaceable"><code>wi-fi</code></em> mode monitor</code></strong>
Success
C:\&gt; <strong class="userinput"><code>WlanHelper.exe <em class="replaceable"><code>wi-fi</code></em> mode </code></strong>
monitor
C:\&gt; <strong class="userinput"><code>WlanHelper.exe <em class="replaceable"><code>wi-fi</code></em> mode managed</code></strong>
Success
C:\&gt; <strong class="userinput"><code>WlanHelper.exe <em class="replaceable"><code>wi-fi</code></em> mode</code></strong>
managed
        </pre></div></div><br class="example-break" /></div></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="npcap-feature-dot11-wireshark"></a>How to use Wireshark to capture raw 802.11 traffic in <span class="quote">“<span class="quote">Monitor Mode</span>”</span></h4></div></div></div><p>
    The latest Wireshark has already integrated the support for Npcap's <span class="quote">“<span class="quote">Monitor Mode</span>”</span> capture.
	If you want to use Wireshark to capture raw 802.11 traffic in <span class="quote">“<span class="quote">Monitor Mode</span>”</span>, you need to
	<span class="emphasis"><em>switch on the monitor mode inside the Wireshark UI instead of using WlanHelper</em></span>.
	This is because Wireshark only recognizes the monitor mode set by itself. So when you turn
	on monitor mode outside Wireshark (like in <code class="filename">WlanHelper</code>), Wireshark will not know the adapter
	has been in monitor mode, and will still try to capture in Ethernet mode, which will get no traffic.

	So after all, the correct steps are:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Install latest version Wireshark and latest version Npcap with
	<code class="option">Support raw 802.11 traffic</code> option checked.</p></li><li class="listitem"><p>Launch Wireshark QT UI (GTK version is similar), go to <span class="quote">“<span class="quote">Capture options</span>”</span>.
	Then toggle the checkbox in the <span class="quote">“<span class="quote">Monitor Mode</span>”</span> column of your wireless adapter's row.
	Click the <span class="quote">“<span class="quote">Start</span>”</span> button. If you see a horizontal line instead of the checkbox,
	then it probably means that your adapter doesn't support monitor mode. You can use the
	<code class="filename">WlanHelper</code> tool to double-check this fact.</p></li><li class="listitem"><p>Stop the capture in Wireshark UI when you finishes capturing, the monitor mode
	will be turned off automatically by Npcap.</p></li></ul></div></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="npcap-qa"></a>Q &amp; A</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Network disconnects after installing Npcap: As Microsoft states
  <a class="ulink" href="https://support.microsoft.com/en-us/kb/2019184" target="_top">here</a>,
  <span class="emphasis"><em>an optional NDIS light-weight filter (LWF) driver like Npcap could cause
  90-second delay in network availability</em></span>. Some solutions you could try
  are: 1) wait for 90 seconds; 2) disable and re-enable the adapter icon in
  <span class="command"><strong>ncpa.cpl</strong></span>; 3) reboot. If this doesn't work,
  please <a class="ulink" href="http://issues.nmap.org/new?title=Npcap+Bug+Report" target="_top">file a bug report</a>.
  </p></li><li class="listitem"><p>Installation fails with error code <code class="varname">0x8004a029</code>:
  The cause is that you have <span class="quote">“<span class="quote">reached the maximum number of network filter
  drivers</span>”</span>, see solution
  <a class="ulink" href="https://social.technet.microsoft.com/Forums/windows/en-US/4deb27fc-33ce-4fc0-a26f-3fec5b57733d/is-there-a-maximum-number-of-network-filter-drivers-in-windows-7?forum=w7itpronetworking" target="_top">here</a>.
  </p></li><li class="listitem"><p>Npcap Loopback Adapter is missing:
  Npcap Loopback Adapter is actually a wrapper of Microsoft Loopback Adapter.
  Such adapters won't show up in Wireshark if the <code class="varname">Basic Filtering Enging (BFE)</code>
  service was not running. To fix this issue, you should start this service at <code class="varname">services.msc</code>
  manually and restart the Npcap service by running <span class="command"><strong>net stop npcap</strong></span>
  and <span class="command"><strong>net start npcap</strong></span>. See details about this issue
  <a class="ulink" href="https://github.com/nmap/nmap/issues/802" target="_top">here</a>.
  </p></li><li class="listitem"><p>Npcap only captures TCP handshake and teardown, but not data packets.
  Some network adapters support offloading of tasks to free up CPU time for
  performance reasons. When this happens, Npcap may not receive all of the
  packets, or may receive them in a different form than is actually sent on the
  wire. To avoid this issue, you may disable TCP Chimney, IP Checksum
  Offloading, and Large Send Offloading in the network adapter properites on
  Windows. See details about this issue in
  <a class="ulink" href="https://github.com/nmap/nmap/issues/989" target="_top">issue
	  #989</a> on our tracker.
  </p></li></ul></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="npcap-issues"></a>Reporting Bugs</h2></div></div></div><p>
  Please report any bugs or issues about Npcap on
  <a class="ulink" href="http://issues.nmap.org/new?title=Npcap+Bug+Report" target="_top">the Nmap Project's Issues tracker</a>.
  In your report, please provide your <span class="emphasis"><em>DiagReport</em></span> output, user
  software version (e.g. Nmap, Wireshark), steps to reproduce the problem, and other information
  you think necessary. If your issue occurs only on a particular OS version (e.g. Win10
  1511, 1607), please mention it in the report.
</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="npcap-issues-diagreport"></a>Diagnostic report</h3></div></div></div><p>
    Npcap has provided a diagnostic utility called <code class="filename">DiagReport</code>.
	It provides a lot of information including OS metadata, Npcap related files,
	install options, registry values, services, etc. You can simply click the
	<code class="filename">C:\Program Files\Npcap\DiagReport.bat</code> file to run <code class="filename">DiagReport</code>.
	It will pop up a text report via Notepad (it's stored in: <code class="filename">C:\Program Files\Npcap\DiagReport.txt</code>).
	Please always submit it to us if you encounter any issues.
    </p><p>
    For Vista users: <code class="filename">DiagReport</code> is a script written for
	<a class="ulink" href="https://msdn.microsoft.com/en-us/powershell/mt173057.aspx" target="_top">Windows PowerShell</a>,
	and Vista doesn't have it installed by default. So if you are using Vista,
	you need to install <span class="emphasis"><em>PowerShell 2.0 (KB968930)</em></span> on your
	system. Please download it <a class="ulink" href="https://www.microsoft.com/en-hk/download/details.aspx?id=9864" target="_top">here for x86</a>
	and <a class="ulink" href="https://www.microsoft.com/en-us/download/details.aspx?id=9239" target="_top">here for x64</a>.
	Win7 and later systems have built-in PowerShell support and don't need
	to do anything about it.
    </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="npcap-issues-installation-log"></a>General installation log</h3></div></div></div><p>
    Npcap keeps track of the installation in a log file:
	<code class="filename">C:\Program Files\Npcap\install.log</code>. Please submit it
	together in your report if you encounter issues during the installation
	(e.g. the installer halts).
    </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="npcap-issues-driver-installation-log"></a>Driver installation log</h3></div></div></div><p>
    Npcap keeps track of the driver installation (aka commands run by
	<code class="filename">NPFInstall.exe</code>) in a log file:
	<code class="filename">C:\Program Files\Npcap\NPFInstall.log</code>, please submit
	it together in your report if you encounter issues during the driver
	installation or problems with the <span class="quote">“<span class="quote">Npcap Loopback Adapter</span>”</span>.
    </p><p>
    There's another system-provided driver installation log in:
	<code class="filename">C:\Windows\INF\setupapi.dev.log</code>.
	If you encounter errors during the driver/service installation, please copy
	the Npcap-related lines out and send them together in
	your report.
    </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="npcap-issues-packet-log"></a>Dynamic link library (DLL) log</h3></div></div></div><p>
      For problems with Npcap's regular operation, you may need to obtain a
      debug log from <code class="filename">Packet.dll</code>.  To do this, you will
      need a debug build of Npcap.  If you are a Npcap developer, you can build
      the <code class="filename">Packet.sln</code> project with the
      <code class="varname">_DEBUG_TO_FILE</code> macro defined. If you are an end user,
      you can contact the Npcap development team for the latest Npcap debug
      build.  The debugging process will continue to append to the debug log
      (<code class="filename">C:\Program Files\Npcap\Packet.log</code>), so you may want
      to delete it after an amount of time, or save your output to another
      place before it gets too large.
    </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="npcap-issues-driver-log"></a>Driver log</h3></div></div></div><p>
    If there is an issue with the Npcap driver, you can open an
    <span class="emphasis"><em>Administrator</em></span> command prompt,  enter <span class="command"><strong>sc query
      npcap</strong></span> to query the driver status and <span class="command"><strong>net start
      npcap</strong></span> to start the driver (replace
    <em class="replaceable"><code>npcap</code></em> with <em class="replaceable"><code>npf</code></em> if you
    installed Npcap in <span class="quote">“<span class="quote">WinPcap Compatible Mode</span>”</span>).  The command
    output will inform you whether there's an error. If the driver is running
    well, but the issue still exists, then you may need to check the driver's
    log. Normal Npcap releases don't switch on the driver log function for
    performance. Contact the Npcap development team to obtain a driver-debug
    version of the Npcap installer.  When you have got an appropriate
    driver-debug version Npcap, you need to use <a class="ulink" href="https://technet.microsoft.com/en-us/sysinternals/debugview.aspx" target="_top">DbgView</a>
    to read the Windows kernel log (which contains our driver log).  You may
    need to turn on DbgView before installing Npcap, if the error occurs when
    the driver loads. When done, save the DbgView output to a file and submit
    it in your report.
    </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="npcap-issues-bsod"></a>Blue screen of death (BSoD) dump</h3></div></div></div><p>
	If you encountered BSoD when using Npcap, please attach the minidump
	file (in <code class="filename">C:\Windows\Minidump\</code>) to your report
	together with the Npcap version. We may ask you to provide the full
	dump (<code class="filename">C:\Windows\MEMORY.DMP</code>) for further troubleshooting.
    </p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="npcap-list"></a>Contact</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="ulink" href="mailto:dev@nmap.org" target="_top">dev@nmap.org</a> - The Nmap development mailing list is the preferred place for general inquiries on Npcap usage, development, or issues.</p></li><li class="listitem"><p><a class="ulink" href="mailto:sales@nmap.com" target="_top">sales@nmap.com</a> - for information about redistribution and licensing.</p></li></ul></div></div></div></body></html>